<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vidhya Bharti Institute - Admission Form</title>
    <style>
        /* Basic styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }
        
        body {
            background-color: #F5F7FA;
            color: #333;
            padding: 20px;
        }
        
        h1, h2, h3 {
            color: #1A237E;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .header h1 {
            margin-bottom: 10px;
        }
        
        .form-section {
            margin-bottom: 25px;
        }
        
        .form-section h2 {
            margin-bottom: 15px;
            font-size: 20px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .row {
            display: flex;
            flex-wrap: wrap;
            margin: 0 -10px;
        }
        
        .col-50 {
            flex: 0 0 100%;
            padding: 0 10px;
        }
        
        @media (min-width: 768px) {
            .col-50 {
                flex: 0 0 50%;
            }
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            margin-bottom: 10px;
        }
        
        .radio-group {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .radio-option {
            display: flex;
            align-items: center;
        }
        
        .radio-option input {
            width: auto;
            margin-right: 5px;
            margin-bottom: 0;
        }
        
        .checkbox-group {
            margin: 15px 0;
        }
        
        .checkbox-option {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .checkbox-option input {
            width: auto;
            margin-right: 5px;
            margin-bottom: 0;
        }
        
        button {
            background-color: #1A237E;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            width: 100%;
        }
        
        button:hover {
            background-color: #0E1257;
        }
        
        .progress-bar {
            display: flex;
            margin-bottom: 30px;
            overflow: hidden;
            border-radius: 4px;
        }
        
        .progress-step {
            flex: 1;
            text-align: center;
            padding: 10px;
            background: #e0e0e0;
            position: relative;
            font-size: 14px;
        }
        
        .progress-step.active {
            background: #1A237E;
            color: white;
        }
        
        .progress-step:not(:first-child):before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            border: 15px solid transparent;
            border-left-color: #e0e0e0;
            border-right-width: 0;
            height: 100%;
        }
        
        .progress-step.active:not(:first-child):before {
            border-left-color: #1A237E;
        }
        
        .buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .back-button {
            background-color: white;
            color: #1A237E;
            border: 1px solid #1A237E;
        }
        
        .submit-button {
            background-color: #FF6D00;
        }
        
        .submit-button:hover {
            background-color: #C43C00;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Vidhya Bharti Institute</h1>
            <p>Admission Application Form</p>
        </div>
        
        <!-- Progress bar -->
        <div class="progress-bar">
            <div class="progress-step active">Personal Info</div>
            <div class="progress-step">Class Selection</div>
            <div class="progress-step">Subject Selection</div>
            <div class="progress-step">Review & Submit</div>
        </div>
        
        <form id="admission-form" action="https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec" method="POST">
            <!-- Personal Information Section -->
            <div class="form-section" id="section-personal">
                <h2>Personal Information</h2>
                <p>Please provide your personal details</p>
                
                <div class="row">
                    <div class="col-50">
                        <div class="form-group">
                            <label for="firstName">First Name*</label>
                            <input type="text" id="firstName" name="firstName" required placeholder="Your first name">
                        </div>
                    </div>
                    <div class="col-50">
                        <div class="form-group">
                            <label for="lastName">Last Name*</label>
                            <input type="text" id="lastName" name="lastName" required placeholder="Your last name">
                        </div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-50">
                        <div class="form-group">
                            <label for="dob">Date of Birth*</label>
                            <input type="date" id="dob" name="dob" required>
                        </div>
                    </div>
                    <div class="col-50">
                        <div class="form-group">
                            <label>Gender*</label>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" id="male" name="gender" value="male" required>
                                    <label for="male">Male</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="female" name="gender" value="female">
                                    <label for="female">Female</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="other" name="gender" value="other">
                                    <label for="other">Other</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-50">
                        <div class="form-group">
                            <label for="phone">Phone Number*</label>
                            <input type="tel" id="phone" name="phone" required placeholder="Your phone number">
                        </div>
                    </div>
                    <div class="col-50">
                        <div class="form-group">
                            <label for="email">Email Address</label>
                            <input type="email" id="email" name="email" placeholder="Your email address">
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="address">Address*</label>
                    <input type="text" id="address" name="address" required placeholder="Your home address">
                </div>
                
                <div class="row">
                    <div class="col-50">
                        <div class="form-group">
                            <label for="city">City*</label>
                            <input type="text" id="city" name="city" required placeholder="Your city">
                        </div>
                    </div>
                    <div class="col-50">
                        <div class="form-group">
                            <label for="pincode">Pincode*</label>
                            <input type="text" id="pincode" name="pincode" required placeholder="Pincode / ZIP">
                        </div>
                    </div>
                </div>
                
                <h3>Parent/Guardian Information</h3>
                
                <div class="row">
                    <div class="col-50">
                        <div class="form-group">
                            <label for="parentName">Parent/Guardian Name*</label>
                            <input type="text" id="parentName" name="parentName" required placeholder="Full name">
                        </div>
                    </div>
                    <div class="col-50">
                        <div class="form-group">
                            <label for="relationship">Relationship*</label>
                            <input type="text" id="relationship" name="relationship" required placeholder="e.g. Father, Mother, Guardian">
                        </div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-50">
                        <div class="form-group">
                            <label for="parentPhone">Parent/Guardian Phone*</label>
                            <input type="tel" id="parentPhone" name="parentPhone" required placeholder="Phone number">
                        </div>
                    </div>
                    <div class="col-50">
                        <div class="form-group">
                            <label for="parentEmail">Parent/Guardian Email</label>
                            <input type="email" id="parentEmail" name="parentEmail" placeholder="Email address">
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Class Selection Section (Initially hidden) -->
            <div class="form-section" id="section-class" style="display: none;">
                <h2>Class Selection</h2>
                <p>Select the class you are applying for</p>
                
                <div class="form-group">
                    <label for="classApplying">Class Applying For*</label>
                    <select id="classApplying" name="classApplying" required>
                        <option value="">Select Class</option>
                        <option value="9">Class 9</option>
                        <option value="10">Class 10</option>
                        <option value="11">Class 11</option>
                        <option value="12">Class 12</option>
                    </select>
                </div>
                
                <div class="form-group" id="stream-group" style="display: none;">
                    <label for="stream">Stream (For Class 11 & 12 only)*</label>
                    <select id="stream" name="stream">
                        <option value="">Select Stream</option>
                        <option value="Science">Science</option>
                        <option value="Commerce">Commerce</option>
                        <option value="Arts">Arts</option>
                    </select>
                </div>
            </div>
            
            <!-- Subject Selection Section (Initially hidden) -->
            <div class="form-section" id="section-subjects" style="display: none;">
                <h2>Subject Selection</h2>
                <p>Select the subjects you want to study</p>
                
                <div id="subjects-container">
                    <!-- Dynamically populated based on class and stream selection -->
                </div>
                
                <div class="form-group">
                    <label>Additional Activities (Optional)</label>
                    <div class="checkbox-group">
                        <div class="checkbox-option">
                            <input type="checkbox" id="sports" name="additionalActivities" value="Sports">
                            <label for="sports">Sports</label>
                        </div>
                        <div class="checkbox-option">
                            <input type="checkbox" id="music" name="additionalActivities" value="Music">
                            <label for="music">Music</label>
                        </div>
                        <div class="checkbox-option">
                            <input type="checkbox" id="arts" name="additionalActivities" value="Arts & Crafts">
                            <label for="arts">Arts & Crafts</label>
                        </div>
                        <div class="checkbox-option">
                            <input type="checkbox" id="debate" name="additionalActivities" value="Debate">
                            <label for="debate">Debate</label>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Review & Submit Section (Initially hidden) -->
            <div class="form-section" id="section-review" style="display: none;">
                <h2>Review & Submit</h2>
                <p>Please review your information before submitting</p>
                
                <div id="review-content">
                    <!-- Will be populated dynamically -->
                </div>
                
                <div class="form-group">
                    <div class="checkbox-option">
                        <input type="checkbox" id="terms" name="terms" required>
                        <label for="terms">I confirm that all the information provided is accurate and complete. I agree to the terms and conditions.</label>
                    </div>
                </div>
            </div>
            
            <!-- Navigation Buttons -->
            <div class="buttons">
                <button type="button" id="prev-btn" class="back-button" style="display: none;">Previous</button>
                <button type="button" id="next-btn">Continue</button>
                <button type="submit" id="submit-btn" class="submit-button" style="display: none;">Submit Application</button>
            </div>
        </form>
    </div>
    
    <script>
        // JavaScript to handle form navigation and submission
        let currentStep = 0;
        const formSections = ['section-personal', 'section-class', 'section-subjects', 'section-review'];
        const progressSteps = document.querySelectorAll('.progress-step');
        
        document.getElementById('next-btn').addEventListener('click', function() {
            // Basic validation
            const currentSection = document.getElementById(formSections[currentStep]);
            const inputs = currentSection.querySelectorAll('input[required], select[required]');
            let isValid = true;
            
            inputs.forEach(input => {
                if (!input.value) {
                    isValid = false;
                    input.style.borderColor = 'red';
                } else {
                    input.style.borderColor = '#ddd';
                }
            });
            
            if (!isValid) {
                alert('Please fill in all required fields.');
                return;
            }
            
            // Special validation for stream selection in class section
            if (currentStep === 1) {
                const classValue = document.getElementById('classApplying').value;
                const streamGroup = document.getElementById('stream-group');
                const streamSelect = document.getElementById('stream');
                
                if ((classValue === '11' || classValue === '12') && streamGroup.style.display !== 'none' && !streamSelect.value) {
                    alert('Please select a stream for your class.');
                    streamSelect.style.borderColor = 'red';
                    return;
                }
            }
            
            // Move to next step
            if (currentStep < formSections.length - 1) {
                document.getElementById(formSections[currentStep]).style.display = 'none';
                currentStep++;
                document.getElementById(formSections[currentStep]).style.display = 'block';
                
                // Update progress bar
                progressSteps.forEach((step, index) => {
                    if (index <= currentStep) {
                        step.classList.add('active');
                    } else {
                        step.classList.remove('active');
                    }
                });
                
                // Update buttons
                document.getElementById('prev-btn').style.display = 'block';
                
                if (currentStep === formSections.length - 1) {
                    document.getElementById('next-btn').style.display = 'none';
                    document.getElementById('submit-btn').style.display = 'block';
                    populateReview();
                }
                
                // Set up subjects if we're at that step
                if (currentStep === 2) {
                    setupSubjects();
                }
            }
        });
        
        document.getElementById('prev-btn').addEventListener('click', function() {
            if (currentStep > 0) {
                document.getElementById(formSections[currentStep]).style.display = 'none';
                currentStep--;
                document.getElementById(formSections[currentStep]).style.display = 'block';
                
                // Update progress bar
                progressSteps.forEach((step, index) => {
                    if (index <= currentStep) {
                        step.classList.add('active');
                    } else {
                        step.classList.remove('active');
                    }
                });
                
                // Update buttons
                if (currentStep === 0) {
                    document.getElementById('prev-btn').style.display = 'none';
                }
                
                document.getElementById('next-btn').style.display = 'block';
                document.getElementById('submit-btn').style.display = 'none';
            }
        });
        
        // Class and stream dependent functionality
        document.getElementById('classApplying').addEventListener('change', function() {
            const streamGroup = document.getElementById('stream-group');
            const streamSelect = document.getElementById('stream');
            
            if (this.value === '11' || this.value === '12') {
                streamGroup.style.display = 'block';
                streamSelect.setAttribute('required', 'required');
            } else {
                streamGroup.style.display = 'none';
                streamSelect.removeAttribute('required');
                streamSelect.value = '';
            }
        });
        
        // Set up subjects based on class and stream
        function setupSubjects() {
            const classValue = document.getElementById('classApplying').value;
            const streamValue = document.getElementById('stream').value;
            const subjectsContainer = document.getElementById('subjects-container');
            
            subjectsContainer.innerHTML = ''; // Clear previous content
            
            let subjects = [];
            
            if (classValue === '9' || classValue === '10') {
                subjects = ['Mathematics', 'Science', 'Social Science', 'English', 'Hindi/Regional Language', 'Computer Science'];
            } else if (classValue === '11' || classValue === '12') {
                if (streamValue === 'Science') {
                    subjects = ['Physics', 'Chemistry', 'Biology', 'Mathematics', 'English', 'Computer Science'];
                } else if (streamValue === 'Commerce') {
                    subjects = ['Accountancy', 'Business Studies', 'Economics', 'Mathematics', 'English', 'Computer Applications'];
                } else if (streamValue === 'Arts') {
                    subjects = ['History', 'Political Science', 'Geography', 'Economics', 'English', 'Sociology'];
                }
            }
            
            if (subjects.length > 0) {
                const subjectHeading = document.createElement('h3');
                subjectHeading.textContent = 'Select your subjects:';
                subjectsContainer.appendChild(subjectHeading);
                
                const subjectNote = document.createElement('p');
                subjectNote.textContent = 'Select at least 5 subjects';
                subjectNote.style.marginBottom = '15px';
                subjectsContainer.appendChild(subjectNote);
                
                subjects.forEach(subject => {
                    const checkboxDiv = document.createElement('div');
                    checkboxDiv.className = 'checkbox-option';
                    
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.id = subject.replace(/\s+/g, '-').toLowerCase();
                    checkbox.name = 'subjects';
                    checkbox.value = subject;
                    
                    const label = document.createElement('label');
                    label.htmlFor = checkbox.id;
                    label.textContent = subject;
                    
                    checkboxDiv.appendChild(checkbox);
                    checkboxDiv.appendChild(label);
                    subjectsContainer.appendChild(checkboxDiv);
                });
            }
        }
        
        // Populate review section
        function populateReview() {
            const reviewContent = document.getElementById('review-content');
            reviewContent.innerHTML = '';
            
            const form = document.getElementById('admission-form');
            const formData = new FormData(form);
            
            // Create sections for the review
            const sections = [
                { title: 'Personal Information', fields: ['firstName', 'lastName', 'dob', 'gender', 'phone', 'email', 'address', 'city', 'pincode'] },
                { title: 'Parent/Guardian Information', fields: ['parentName', 'relationship', 'parentPhone', 'parentEmail'] },
                { title: 'Academic Information', fields: ['classApplying', 'stream'] },
            ];
            
            sections.forEach(section => {
                const sectionDiv = document.createElement('div');
                sectionDiv.className = 'review-section';
                
                const sectionTitle = document.createElement('h3');
                sectionTitle.textContent = section.title;
                sectionTitle.style.marginTop = '20px';
                sectionTitle.style.marginBottom = '10px';
                sectionDiv.appendChild(sectionTitle);
                
                const sectionTable = document.createElement('table');
                sectionTable.style.width = '100%';
                sectionTable.style.borderCollapse = 'collapse';
                
                section.fields.forEach(field => {
                    if (formData.has(field) && formData.get(field)) {
                        const row = document.createElement('tr');
                        
                        const labelCell = document.createElement('td');
                        labelCell.textContent = field.charAt(0).toUpperCase() + field.slice(1).replace(/([A-Z])/g, ' $1');
                        labelCell.style.fontWeight = 'bold';
                        labelCell.style.padding = '8px';
                        labelCell.style.width = '40%';
                        labelCell.style.borderBottom = '1px solid #eee';
                        
                        const valueCell = document.createElement('td');
                        valueCell.textContent = formData.get(field);
                        valueCell.style.padding = '8px';
                        valueCell.style.borderBottom = '1px solid #eee';
                        
                        row.appendChild(labelCell);
                        row.appendChild(valueCell);
                        sectionTable.appendChild(row);
                    }
                });
                
                sectionDiv.appendChild(sectionTable);
                reviewContent.appendChild(sectionDiv);
            });
            
            // Handle subjects separately because they're checkboxes (multiple values)
            const subjectsTitle = document.createElement('h3');
            subjectsTitle.textContent = 'Selected Subjects';
            subjectsTitle.style.marginTop = '20px';
            subjectsTitle.style.marginBottom = '10px';
            reviewContent.appendChild(subjectsTitle);
            
            const subjectsList = document.createElement('ul');
            subjectsList.style.marginLeft = '20px';
            
            const selectedSubjects = [];
            document.querySelectorAll('input[name="subjects"]:checked').forEach(checkbox => {
                selectedSubjects.push(checkbox.value);
            });
            
            if (selectedSubjects.length > 0) {
                selectedSubjects.forEach(subject => {
                    const listItem = document.createElement('li');
                    listItem.textContent = subject;
                    listItem.style.marginBottom = '5px';
                    subjectsList.appendChild(listItem);
                });
            } else {
                const listItem = document.createElement('li');
                listItem.textContent = 'No subjects selected';
                subjectsList.appendChild(listItem);
            }
            
            reviewContent.appendChild(subjectsList);
            
            // Additional activities
            const activitiesTitle = document.createElement('h3');
            activitiesTitle.textContent = 'Additional Activities';
            activitiesTitle.style.marginTop = '20px';
            activitiesTitle.style.marginBottom = '10px';
            reviewContent.appendChild(activitiesTitle);
            
            const activitiesList = document.createElement('ul');
            activitiesList.style.marginLeft = '20px';
            
            const selectedActivities = [];
            document.querySelectorAll('input[name="additionalActivities"]:checked').forEach(checkbox => {
                selectedActivities.push(checkbox.value);
            });
            
            if (selectedActivities.length > 0) {
                selectedActivities.forEach(activity => {
                    const listItem = document.createElement('li');
                    listItem.textContent = activity;
                    listItem.style.marginBottom = '5px';
                    activitiesList.appendChild(listItem);
                });
            } else {
                const listItem = document.createElement('li');
                listItem.textContent = 'No additional activities selected';
                activitiesList.appendChild(listItem);
            }
            
            reviewContent.appendChild(activitiesList);
        }
        
        // Form submission handler
        document.getElementById('admission-form').addEventListener('submit', async function(event) {
            event.preventDefault();
            
            // Check terms checkbox
            if (!document.getElementById('terms').checked) {
                alert('Please agree to the terms and conditions.');
                return;
            }
            
            // Get the form data
            const form = document.getElementById('admission-form');
            const formData = new FormData(form);
            
            // Create JSON object
            const jsonData = {};
            formData.forEach((value, key) => {
                // Handle multiple selections (checkboxes)
                if (key === 'subjects' || key === 'additionalActivities') {
                    if (!jsonData[key]) {
                        jsonData[key] = [];
                    }
                    jsonData[key].push(value);
                } else {
                    jsonData[key] = value;
                }
            });
            
            // Get the Google Script URL
            const scriptURL = form.action;
            
            try {
                document.getElementById('submit-btn').disabled = true;
                document.getElementById('submit-btn').textContent = 'Submitting...';
                
                // Send the data
                const response = await fetch(scriptURL, {
                    method: 'POST',
                    mode: 'cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(jsonData),
                });
                
                if (response.ok) {
                    const result = await response.json();
                    if (result.success) {
                        alert('Application submitted successfully! Your application ID is: ' + result.applicationId);
                        form.reset();
                        window.location.href = '/success.html'; // Redirect to success page
                    } else {
                        alert('Error: ' + result.message);
                    }
                } else {
                    throw new Error('Network response was not ok.');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('There was an error submitting your application. Please try again later.');
                
                // Store locally as fallback
                const applicationId = 'APP' + Math.floor(100000 + Math.random() * 900000);
                const applicationData = {
                    ...jsonData,
                    applicationId,
                    createdAt: new Date().toISOString()
                };
                
                const storedApplications = JSON.parse(localStorage.getItem('applications') || '[]');
                storedApplications.push(applicationData);
                localStorage.setItem('applications', JSON.stringify(storedApplications));
                
                alert('Your application has been saved locally. Your application ID is: ' + applicationId);
                form.reset();
            } finally {
                document.getElementById('submit-btn').disabled = false;
                document.getElementById('submit-btn').textContent = 'Submit Application';
            }
        });
    </script>
</body>
</html>
